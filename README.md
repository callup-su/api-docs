# api-docs
документация API для Call Up

## Терминология
Название файла            | Содержание файла
--------------------------|----------------------
Идентификация             | Процедура, в результате выполнения которой пользователю выделяется идентификатор, однозначно определяющий его.
Аутентификация            | Процедура проверки подлинности, путем сравнения введенного пароля с паролем, сохраненным в базе данных.
App/приложение/клиент     | Сайт, сервис, нативное приложение, где необходимо аутентифицировать пользователя.
AppToken/токен приложения | код в формате uiid, который идентифицирует приложение в системе CallUp
Заказ                     | в контексте системы CallUp - это полученный запрос от приложения, на процедуру аутентификации пользователя через систему CallUp
Call-ID/ид заказа         | идентификатор заказа(uiid), который сервис CallUp присваивает новому заказу, при его формировании
Код аутентификации        | Это четырехзначный цифровой код, необходимый для прохождения аутентификации. последние 4 цифры номера с которого будет осуществлён вызов. 
номера А                  | Номер с которого будет осуществлено входящее телефонное соединение.

## Описание
Сервис CallUp предназначен для аутентификации пользователей, по средством генерации одноразовых кодов аутентификации, передачи этих кодов в телефонных вызовах как часть номера А. И последующего сравнения полученного и отправленного кодов.

Взаимодействие сервиса с клиентом(приложением) происходит по http протоколу через rest-api

# REST API
## Общий формат ответа:
```http
{
  "data": {},
  "errors": [
    {
      "message": "..."
    }
  ]
}
```
**data**: _null_ или _{}_

содержимое ответа

**errors**: _null_ или []

массив ошибок в формате:
*  message: тест ошибки

### Успешный запрос
При успешном выполнении запроса возвращается 200 код с телом ответа в формате:
```http
{
  "data": {},
  "errors": null
}
```

### Ошибка
```http
{
  "data": null,
  "errors": [
    {
      "message": "..."
    }
  ]
}
```

Коды ответа:

код |   message     | описание
----|---------------|---
403 | access denied | Токен не найден или заблокирован. Приложение заблокировано.
... |  ...          | ... 


## Создание заказа на звонок [ /v1/orders ]
Для создания заказа на осуществление звонка существует 3 схемы работы приложения:

## Схема №1 Стандартная

### Запрос
Для создания заказа на осуществление звонка в данном варианте, необходимо отправить POST запрос на /v1/orders без дополнительных get-параметров и передав в теле запроса телефон пользователя(параметр phone):

```http request
POST /v1/orders
HOST <адрес сервиса CallUp>
Content-Type: application/json
X-Application-Token: uuid-v4-app-token

{"phone": "<телефон пользователя>"}
```
**endpoint**: /v1/orders

**X-Application-Token**: уникальный токен приложения(AppToken). Необходимо передавать во всех запросах.

**phone**: номер телефона строкой из 11 цифр. На данный номер сервис будет передавать одноразовые коды в виде входящих телефонных соединений, где код аутентификации будет содержаться в 4-х последних цифрах номера А.

### Ответ
```http
{
  "data": {
    "id": "6999f209-5bb6-4581-9f91-5dba38812e13",
    "cid": {
      "prefix": "7487260",
      "mask": "7487260****"
    },
    "code": {
      "len": 4
    }
  },
  "errors": null
}
```
Содержимое объекта data:

**id**: уникальный id заказа(Call-ID)

**cid.prefix**: префикс номера с которого будет осуществлён звонок

**cid.mask**: маска номера с которого будет осуществлён звонок

**code.len**: длинна кода


## Схема №2 С моментальным возвратом кода аутентификации 

### Запрос
Если вам необходимо сразу в ответе получить не только токен заказа, но и кода аутентификации,то к вышеописанному запросу из Схемы №1 необходимо прибавить get-параметр 
fields=code.value . Все остальные параметры остаются без изменения:


```http request
POST /v1/orders?fields=code.value
HOST <адрес сервиса CallUp>
Content-Type: application/json
X-Application-Token: uuid-v4-app-token

{"phone": "<телефон пользователя>"}
```

### Ответ
Ответ в таком варианте будет следующим:
```http
{
  "data": {
    "id": "6999f209-5bb6-4581-9f91-5dba38812e13",
    "cid": {
      "prefix": "7487260",
      "mask": "7487260****"
    },
    "code": {
      "len": 4,
      "value": "0345"
    }
  },
  "errors": null
}
```
**code.value**: кода аутентификации, который пользователь сможет получить, списав последние 4 цифры, после осуществления звонка

## Схема №3 Генерация звонка с заданным кодом аутентификации

### Запрос
Апи CallUp так же предоставляет возможность самим задать код аутентификации для будущего звонка.  Если вам необходимо задать свой код аутентификации,то к вышеописанному запросу из Схемы №1 необходимо добавить в тело запроса параметр "code":"<желаемый код аутентификации>". Все остальные параметры остаются без изменения(см. Схему №1):

```http request
POST /v1/orders
HOST <адрес сервиса CallUp>
Content-Type: application/json
X-Application-Token: uuid-v4-app-token

{
"phone": "<телефон пользователя>",
"code":  "<желаемый код аутентификации>"
}
```

### Ответ
Ответ в таком варианте будет следующим:
```http
{
  "data": {
    "id": "6999f209-5bb6-4581-9f91-5dba38812e13",
    "cid": {
      "prefix": "7487260",
      "mask": "7487260****"
    },
    "code": {
      "len": 4,
      "value": "0345"
    }
  },
  "errors": null
}
```
**code.value**: кода аутентификации


Аутентификация [ /v1/auth ]
===
Для проверки кода аутентификации необходимо отправить GET запрос на /v1/auth/<uiid заказа>/<кода аутентификации>:
```http request
GET /v1/auth/{order_id}/{order_code}
HOST <адрес сервиса CallUp>
X-Application-Token: uuid-v4-app-token
```
**order_id**: ид заказа

**order_code**: четырехзначный код

Ответ:
```http
{
  "data": {
    "success": true
  },
  "errors": null
}
```
или
```http
{
  "data": null,
  "errors": [
    {
      "message": "...error message..."
    }
  ]
}
```
